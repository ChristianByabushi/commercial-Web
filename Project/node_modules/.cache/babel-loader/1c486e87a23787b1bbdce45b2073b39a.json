{"ast":null,"code":"import axios from 'axios';\nimport html2pdf from \"html2pdf.js\";\nexport default {\n  name: \"Invoice\",\n  components: {},\n  data: () => ({\n    indexEdit: 'add',\n    printInvoice: null,\n    editOradd: null,\n    created_at: new Date().toJSON().slice(0, 10).replace(/-/g, '/'),\n    client: '',\n    title: '',\n    decrease: '',\n    pu_sale: '',\n    amount_sale: '',\n    id_stock: '',\n    stock_merchandises: [],\n    pu_by: '',\n    amount_by: '',\n    listOfitemInvoices: [],\n    lastIdLine: '',\n    invoicesRequests: [],\n    desserts: [{\n      name: 'Frozen Yogurt',\n      calories: 159\n    }]\n  }),\n  methods: {\n    exportToPDF() {\n      html2pdf(document.getElementById(\"element-to-convert\"), {\n        margin: 5,\n        filename: \"i-was-html.pdf\"\n      });\n    },\n\n    getNumberInvoices() {\n      return this.listOfitemInvoices.length;\n    },\n\n    getTotalPriceAmount() {\n      let totalNetPrice = 0;\n      this.listOfitemInvoices.forEach(element => {\n        totalNetPrice += element.amount_sale * element.pu_sale;\n      });\n      totalNetPrice = Number(totalNetPrice - this.decrease).toFixed(3);\n      return totalNetPrice;\n    },\n\n    submitNewItemInvoice() {\n      if (this.id_stock == '' || this.pu_sale == '' || this.amount_sale == '') {\n        alert('Veuillez completer tous les éléments du formulaire');\n        return;\n      } //verify if the amount convey\n\n\n      if (this.amount_by < this.amount_sale) {\n        alert('Quantité en stock non suffisante pour effectuer cette opération !');\n        return;\n      } //case of edit now\n\n\n      if (this.indexEdit != 'add') {\n        this.listOfitemInvoices[this.indexEdit].pu_sale = Math.abs(this.pu_sale);\n        this.listOfitemInvoices[this.indexEdit].amount_sale = Math.abs(this.amount_sale);\n        this.listOfitemInvoices[this.indexEdit].id_stock = Math.abs(this.id_stock);\n      } //case of add \n      else {\n        //case of item exesting already on the invoice\n        var verifyIfItemExistAlready = false;\n        this.listOfitemInvoices.forEach(element => {\n          if (element.id_stock == this.id_stock) {\n            verifyIfItemExistAlready = true;\n            alert(\"Au lieu d'insérer le meme item veuillez éditer celui qui est déjà présent sur la facture\");\n          }\n        });\n\n        if (verifyIfItemExistAlready == true) {\n          return;\n        } //case of all works funny\n\n\n        this.listOfitemInvoices.push({\n          id_stock: this.id_stock,\n          title: this.title,\n          pu_sale: Math.abs(this.pu_sale),\n          amount_sale: Math.abs(this.amount_sale)\n        }); //to make difference with edit task\n      } //initiation\n\n\n      this.title = '';\n      this.pu_sale = '';\n      this.amount_sale = '';\n      this.id_stock = '';\n      this.pu_by = '';\n      this.indexEdit = 'add';\n    },\n\n    editItemInvoice(index) {\n      this.title = this.listOfitemInvoices[index].title;\n      this.pu_sale = this.listOfitemInvoices[index].pu_sale;\n      this.amount_sale = this.listOfitemInvoices[index].amount_sale;\n      this.id_stock = this.listOfitemInvoices[index].id_stock;\n      this.indexEdit = index;\n    },\n\n    deleteItemInvoice(index) {\n      this.listOfitemInvoices.splice(index, 1); // if the item deleted is what we re editing we reinitiate the form!\n\n      if (this.indexEdit == index) {\n        this.title = '';\n        this.pu_sale = '';\n        this.amount_sale = '';\n        this.id_stock = '';\n        this.indexEdit = 'add';\n        this.pu_by = '';\n      }\n    },\n\n    seek_amount_and_price_stock() {\n      this.stock_merchandises.forEach(element => {\n        if (element.id_stock == this.id_stock) {\n          this.pu_by = element.pu_by;\n          this.title = element.title;\n        }\n      });\n    },\n\n    async get_stock_merchandise() {\n      try {\n        const response = await axios.post('stock_merchandise/');\n        this.stock_merchandises = response.data;\n      } catch (e) {\n        alert(e);\n      }\n    },\n\n    tryF() {},\n\n    async verifyAmount() {\n      if (this.id_stock != '') {\n        const response = await axios.post('invoice/verifyAmount/' + this.id_stock);\n        this.amount_by = response.data;\n      }\n    },\n\n    async create_new_line_invoice_and_invoices() {\n      if (this.client != '' && this.getNumberInvoices() > 0) {\n        try {\n          const form = new FormData();\n          form.append('client', this.client);\n          form.append('decrease', this.decrease);\n          form.append('created_at', this.created_at + this.getCurrentTime());\n          form.append('listOfitemInvoices', this.created_at + this.listOfitemInvoices);\n          const response = await axios.post('lineInvoice/create', form);\n          this.lastIdLine = response.data;\n          console.log(response.data); //i can now record each invoices\n        } catch (e) {\n          alert(e);\n        }\n      } else {\n        alert(\"Veuiller d'abord compléter tous les champs requis pour une facture\");\n      }\n    },\n\n    async trySendInvoice() {\n      // const getFormData = object => Object.entries(object).reduce((fd, [key, val]) => { \n      // \tif (Array.isArray(val)) {\n      // \t\tval.forEach(v => fd.append(key, v))\n      // \t} else {\n      // \t\tfd.append(key, val)\n      // \t}\n      // \treturn fd\n      // }, new FormData());\n      const formData = new FormData();\n      formData.append(\"listOfitemInvoices\", JSON.stringify(this.listOfitemInvoices)); // const response = await axios.post('invoice/create/', formData)\n      // console.log(response.data)\n\n      axios.post(\"invoice/create/\", formData, {\n        onUploadProgress: progressEvent => console.log(progressEvent.loaded),\n        headers: {\n          \"Content-Type\": \"multipart/form-data\"\n        }\n      });\n    },\n\n    async async_create_each_invoice() {\n      this.listOfitemInvoices.forEach(element => {\n        // const formData = new FormData()\n        // formData.append(\"amount_sale\", element.amount_sale)\n        // formData.append(\"id_stock\", element.id_stock)\n        // formData.append(\"pu_sale\", element.pu_sale)\n        // formData.append(\"id_line\", this.lastIdLine)\n        this.invoicesRequests.push(axios.post('invoice/create', {\n          \"amount_sale\": element.amount_sale,\n          \"id_stock\": element.id_stock,\n          \"pu_sale\": element.pu_sale,\n          \"id_line\": this.lastIdLine\n        }).then(response => {}));\n      });\n      Promise.all(this.invoicesRequests).then(() => console.log('all recorded')); // await axios\n      // \t.all([\n      // \t\tthis.listOfitemInvoices.forEach(element => {\n      // \t\t\tconst formData = new FormData()\n      // \t\t\tformData.append(\"amount_sale\", element.amount_sale)\n      // \t\t\tformData.append(\"id_stock\", element.id_stock)\n      // \t\t\tformData.append(\"pu_sale\", element.pu_sale)\n      // \t\t\tformData.append(\"id_line\", this.lastIdLine)\n      // \t\t\taxios.post('invoice/create', formData)\n      // \t\t})\n      // \t])\n      // \t.then(\n      // \t\taxios.spread((...responses) => {\n      // \t\t\tconsole.log(responses)\n      // \t\t})\n      // \t)\n      // \t.catch(errors => {\n      // \t\tconsole.error(errors)\n      // \t});\n    },\n\n    getCurrentTime() {\n      const dateObj = new Date();\n      const currentDate = \":\" + dateObj.getHours() + ':' + dateObj.getMinutes() + ':' + dateObj.getSeconds();\n      return currentDate;\n    }\n\n  },\n\n  created() {\n    this.get_stock_merchandise();\n  }\n\n};","map":{"version":3,"mappings":"AAmHA;AACA;AACA;EACAA,eADA;EAEAC,cAFA;EAIAC;IACAC,gBADA;IAEAC,kBAFA;IAGAC,eAHA;IAIAC,+DAJA;IAKAC,UALA;IAMAC,SANA;IAOAC,YAPA;IAQAC,WARA;IASAC,eATA;IAUAC,YAVA;IAWAC,sBAXA;IAYAC,SAZA;IAaAC,aAbA;IAcAC,sBAdA;IAeAC,cAfA;IAgBAC,oBAhBA;IAiBAC,WACA;MACAnB,qBADA;MAEAoB;IAFA,CADA;EAjBA,EAJA;EA6BAC;IACAC;MACAC;QACAC,SADA;QAEAC;MAFA;IAKA,CAPA;;IAUAC;MACA;IACA,CAZA;;IAcAC;MACA;MACA;QACAC;MACA,CAFA;MAGAA;MACA;IACA,CArBA;;IAuBAC;MACA;QACAC;QACA;MACA,CAJA,CAMA;;;MACA;QACAA;QACA;MACA,CAVA,CAYA;;;MACA;QACA;QACA;QACA;MACA,CAJA,CAMA;MANA,KAOA;QAEA;QACA;QACA;UACA;YACAC;YACAD;UACA;QACA,CALA;;QAMA;UACA;QACA,CAZA,CAaA;;;QACA;UACAlB,uBADA;UAEAJ,iBAFA;UAGAE,+BAHA;UAIAC;QAJA,GAdA,CAoBA;MACA,CAzCA,CA0CA;;;MACA;MACA;MACA;MACA;MACA;MACA;IACA,CAxEA;;IAyEAqB;MACA;MACA;MACA;MACA;MACA;IACA,CA/EA;;IAgFAC;MACA,yCADA,CAEA;;MACA;QACA;QACA;QACA;QACA;QACA;QACA;MACA;IACA,CA3FA;;IA4FAC;MACA;QACA;UACA;UACA;QACA;MACA,CALA;IAMA,CAnGA;;IAqGA;MACA;QACA;QACA;MACA,CAHA,CAGA;QACAJ;MACA;IACA,CA5GA;;IA6GAK,QAGA,CAhHA;;IAkHA;MACA;QACA;QACA;MACA;IACA,CAvHA;;IAwHA;MACA;QACA;UACA;UACAC;UACAA;UACAA;UACAA;UACA;UACA;UACAC,2BARA,CASA;QACA,CAVA,CAUA;UACAP;QACA;MACA,CAdA,MAcA;QACAA;MACA;IACA,CA1IA;;IA4IA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACAQ,+EAVA,CAWA;MACA;;MACAC,MACAC,IADA,CACA,iBADA,EACAF,QADA,EACA;QACAG,oEADA;QAEAC;UAAA;QAAA;MAFA,CADA;IAeA,CAxKA;;IAyKA;MACA;QACA;QACA;QACA;QACA;QACA;QACA,wDACA;UACA,kCADA;UAEA,4BAFA;UAGA,0BAHA;UAIA;QAJA,CADA,EAOAC,IAPA,CAOAC,aAEA,CATA;MAUA,CAhBA;MAkBAC,2EAnBA,CAqBA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA,CAjNA;;IAmNAC;MACA;MACA;MACA;IACA;;EAvNA,CA7BA;;EAsPAC;IACA;EACA;;AAxPA","names":["name","components","data","indexEdit","printInvoice","editOradd","created_at","client","title","decrease","pu_sale","amount_sale","id_stock","stock_merchandises","pu_by","amount_by","listOfitemInvoices","lastIdLine","invoicesRequests","desserts","calories","methods","exportToPDF","html2pdf","margin","filename","getNumberInvoices","getTotalPriceAmount","totalNetPrice","submitNewItemInvoice","alert","verifyIfItemExistAlready","editItemInvoice","deleteItemInvoice","seek_amount_and_price_stock","tryF","form","console","formData","axios","post","onUploadProgress","headers","then","response","Promise","getCurrentTime","created"],"sourceRoot":"src/views/invoices","sources":["invoice.vue"],"sourcesContent":["<template>\r\n\t<div>\r\n\t\t<v-subheader class=\"d-flex justify-space-between align-center\">\r\n\t\t\t<h3>Facture et ventes</h3>\r\n\t\t</v-subheader>\r\n\t\t<v-alert dense type=\"info\" color=\"indigo\">\r\n\t\t\tCette partie du HumanApp porte sur les fonctionnalités liées à la gestion des factures et vente\r\n\t\t</v-alert>\r\n\t\t<v-card>\r\n\t\t\t<v-card-title class=\"d-flex-inline\">\r\n\t\t\t\t<v-row>\r\n\t\t\t\t\t<h5>Société, Human Atm, Facturation</h5>\r\n\t\t\t\t</v-row>\r\n\t\t\t</v-card-title>\r\n\t\t</v-card>\r\n\t\t<v-container>\r\n\t\t\t<v-row>\r\n\t\t\t\t<v-col cols=\"5\" sm=\"3\">\r\n\t\t\t\t\t<v-select :items=\"stock_merchandises\" @change=\"verifyAmount();seek_amount_and_price_stock()\"\r\n\t\t\t\t\t\titem-text=\"title\" v-model=\"id_stock\" item-value=\"id_stock\" label=\"Item\">\r\n\t\t\t\t\t</v-select>\r\n\t\t\t\t</v-col>\r\n\t\t\t\t<v-col>\r\n\t\t\t\t\t<v-text-field v-model=\"pu_sale\" type=\"number\" step=\"any\" label=\"Pu\" required>\r\n\t\t\t\t\t</v-text-field>\r\n\t\t\t\t</v-col>\r\n\t\t\t\t<v-col>\r\n\t\t\t\t\t<v-text-field v-model=\"amount_sale\" type=\"number\" step=\"any\" label=\"Qté\" required>\r\n\t\t\t\t\t</v-text-field>\r\n\t\t\t\t</v-col>\r\n\t\t\t\t<v-col cols=\"2\" sm=\"4\">\r\n\t\t\t\t\t<v-alert color=\"blue-grey\" dark> Prix total: {{Number(amount_sale*pu_sale).toFixed(4)}}\r\n\t\t\t\t\t</v-alert>\r\n\t\t\t\t</v-col>\r\n\t\t\t\t<v-col cols=\"12\" sm=\"6\" class=\"d-flex\" v-if=\"pu_by\">\r\n\t\t\t\t\t<v-alert color=\"dense\" type=\"info\">Le pua de ce bien était de {{pu_by}} $ et il restait\r\n\t\t\t\t\t\t{{amount_by}} unités </v-alert>\r\n\t\t\t\t</v-col>\r\n\t\t\t\t<v-col cols=\"12\" sm=\"6\">\r\n\t\t\t\t\t<v-btn @click=\"verifyAmount(); submitNewItemInvoice()\" class=\"mb-1\">\r\n\t\t\t\t\t\t<span v-if=\"indexEdit!='add'\">Editer</span>\r\n\t\t\t\t\t\t<span v-else>Ajouter</span>\r\n\t\t\t\t\t</v-btn>\r\n\t\t\t\t</v-col>\r\n\t\t\t</v-row>\r\n\t\t\t<v-form method=\"post\" class=\"mb-4\">\r\n\t\t\t\t<div id=\"element-to-convert\">\r\n\t\t\t\t\t<v-simple-table>\r\n\t\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t<th class=\"text-left\">\r\n\t\t\t\t\t\t\t\t\tIdStock\r\n\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t<th class=\"text-left\">\r\n\t\t\t\t\t\t\t\t\tMarchandise\r\n\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t<th class=\"text-left\">\r\n\t\t\t\t\t\t\t\t\tPu\r\n\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t<th class=\"text-left\">\r\n\t\t\t\t\t\t\t\t\tQté\r\n\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t<th class=\"text-left\">\r\n\t\t\t\t\t\t\t\t\tPrix Total\r\n\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t\t<th class=\"text-left\">\r\n\t\t\t\t\t\t\t\t\tActions\r\n\t\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t</thead>\r\n\t\t\t\t\t\t<tbody>\r\n\r\n\t\t\t\t\t\t\t<tr v-for=\"(item, index) in listOfitemInvoices\" :key=\"item.id_stock\">\r\n\t\t\t\t\t\t\t\t<td>{{ item.id_stock }}</td>\r\n\t\t\t\t\t\t\t\t<td>{{ item.title }}</td>\r\n\t\t\t\t\t\t\t\t<td>{{ item.pu_sale }}</td>\r\n\t\t\t\t\t\t\t\t<td>{{ item.amount_sale }}</td>\r\n\t\t\t\t\t\t\t\t<td>{{ Number(item.pu_sale*item.amount_sale).toFixed(3) }}</td>\r\n\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t<v-icon small color=\"purple\" @click=\"editItemInvoice(index)\">mdi-pencil\r\n\t\t\t\t\t\t\t\t\t</v-icon>\r\n\t\t\t\t\t\t\t\t\t<v-icon small color=\"red\" @click=\"deleteItemInvoice(index)\">\r\n\t\t\t\t\t\t\t\t\t\tmdi-delete\r\n\t\t\t\t\t\t\t\t\t</v-icon>\r\n\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t</tbody>\r\n\t\t\t\t\t</v-simple-table>\r\n\t\t\t\t</div>\r\n\t\t\t\t<v-row class=\"mt-4\">\r\n\t\t\t\t\t<v-col cols=\"12\" sm=\"6\">\r\n\t\t\t\t\t\t<v-text-field v-model=\"client\" type=\"text\" label=\"Client\" required>\r\n\t\t\t\t\t\t</v-text-field>\r\n\t\t\t\t\t\t<div v-if=\"getNumberInvoices()>0\">\r\n\t\t\t\t\t\t\t<v-text-field v-model=\"created_at\" type=\"date\" label=\"Date de Vente\" required>\r\n\t\t\t\t\t\t\t</v-text-field>\r\n\t\t\t\t\t\t\t<v-text-field v-model=\"decrease\" type=\"number\" step=\"any\" label=\"Reduction sur facture\">\r\n\t\t\t\t\t\t\t</v-text-field>\r\n\t\t\t\t\t\t\t<v-alert color=\"indigo\" dark v-if=\"listOfitemInvoices\">\r\n\t\t\t\t\t\t\t\tPrix total net à payer : {{getTotalPriceAmount()}}\r\n\t\t\t\t\t\t\t</v-alert>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</v-col>\r\n\t\t\t\t</v-row>\r\n\t\t\t\t<v-btn v-if=\"printInvoice\" @click.stop=\"exportToPDF()\" class=\"d-flex mt-10\">\r\n\t\t\t\t\tPrint\r\n\t\t\t\t</v-btn>\r\n\t\t\t\t<v-btn class=\"d-flex mt-10\" @click.stop=\"create_new_line_invoice_and_invoices(); trySendInvoice()\">\r\n\t\t\t\t\tEnregistrer\r\n\t\t\t\t</v-btn>\r\n\t\t\t</v-form>\r\n\t\t</v-container>\r\n\t</div>\r\n</template> \r\n<script>\r\nimport axios from 'axios'\r\nimport html2pdf from \"html2pdf.js\";\r\nexport default {\r\n\tname: \"Invoice\",\r\n\tcomponents: {\r\n\t},\r\n\tdata: () => ({\r\n\t\tindexEdit: 'add',\r\n\t\tprintInvoice: null,\r\n\t\teditOradd: null,\r\n\t\tcreated_at: new Date().toJSON().slice(0, 10).replace(/-/g, '/'),\r\n\t\tclient: '',\r\n\t\ttitle: '',\r\n\t\tdecrease: '',\r\n\t\tpu_sale: '',\r\n\t\tamount_sale: '',\r\n\t\tid_stock: '',\r\n\t\tstock_merchandises: [],\r\n\t\tpu_by: '',\r\n\t\tamount_by: '',\r\n\t\tlistOfitemInvoices: [],\r\n\t\tlastIdLine: '',\r\n\t\tinvoicesRequests: [],\r\n\t\tdesserts: [\r\n\t\t\t{\r\n\t\t\t\tname: 'Frozen Yogurt',\r\n\t\t\t\tcalories: 159,\r\n\t\t\t}\r\n\t\t],\r\n\t}),\r\n\r\n\tmethods: {\r\n\t\texportToPDF() {\r\n\t\t\thtml2pdf(document.getElementById(\"element-to-convert\"), {\r\n\t\t\t\tmargin: 5,\r\n\t\t\t\tfilename: \"i-was-html.pdf\",\r\n\r\n\t\t\t});\r\n\t\t},\r\n\r\n\r\n\t\tgetNumberInvoices() {\r\n\t\t\treturn this.listOfitemInvoices.length\r\n\t\t},\r\n\r\n\t\tgetTotalPriceAmount() {\r\n\t\t\tlet totalNetPrice = 0\r\n\t\t\tthis.listOfitemInvoices.forEach(element => {\r\n\t\t\t\ttotalNetPrice += element.amount_sale * element.pu_sale\r\n\t\t\t});\r\n\t\t\ttotalNetPrice = Number(totalNetPrice - this.decrease).toFixed(3)\r\n\t\t\treturn totalNetPrice\r\n\t\t},\r\n\r\n\t\tsubmitNewItemInvoice() {\r\n\t\t\tif (this.id_stock == '' || this.pu_sale == '' || this.amount_sale == '') {\r\n\t\t\t\talert('Veuillez completer tous les éléments du formulaire')\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\t//verify if the amount convey\r\n\t\t\tif (this.amount_by < this.amount_sale) {\r\n\t\t\t\talert('Quantité en stock non suffisante pour effectuer cette opération !')\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\t//case of edit now\r\n\t\t\tif (this.indexEdit != 'add') {\r\n\t\t\t\tthis.listOfitemInvoices[this.indexEdit].pu_sale = Math.abs(this.pu_sale);\r\n\t\t\t\tthis.listOfitemInvoices[this.indexEdit].amount_sale = Math.abs(this.amount_sale);\r\n\t\t\t\tthis.listOfitemInvoices[this.indexEdit].id_stock = Math.abs(this.id_stock);\r\n\t\t\t}\r\n\r\n\t\t\t//case of add \r\n\t\t\telse {\r\n\r\n\t\t\t\t//case of item exesting already on the invoice\r\n\t\t\t\tvar verifyIfItemExistAlready = false\r\n\t\t\t\tthis.listOfitemInvoices.forEach(element => {\r\n\t\t\t\t\tif (element.id_stock == this.id_stock) {\r\n\t\t\t\t\t\tverifyIfItemExistAlready = true\r\n\t\t\t\t\t\talert(\"Au lieu d'insérer le meme item veuillez éditer celui qui est déjà présent sur la facture\")\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (verifyIfItemExistAlready == true) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t//case of all works funny\r\n\t\t\t\tthis.listOfitemInvoices.push({\r\n\t\t\t\t\tid_stock: this.id_stock,\r\n\t\t\t\t\ttitle: this.title,\r\n\t\t\t\t\tpu_sale: Math.abs(this.pu_sale),\r\n\t\t\t\t\tamount_sale: Math.abs(this.amount_sale),\r\n\t\t\t\t})\r\n\t\t\t\t//to make difference with edit task\r\n\t\t\t}\r\n\t\t\t//initiation\r\n\t\t\tthis.title = ''\r\n\t\t\tthis.pu_sale = ''\r\n\t\t\tthis.amount_sale = ''\r\n\t\t\tthis.id_stock = ''\r\n\t\t\tthis.pu_by = ''\r\n\t\t\tthis.indexEdit = 'add'\r\n\t\t},\r\n\t\teditItemInvoice(index) {\r\n\t\t\tthis.title = this.listOfitemInvoices[index].title;\r\n\t\t\tthis.pu_sale = this.listOfitemInvoices[index].pu_sale;\r\n\t\t\tthis.amount_sale = this.listOfitemInvoices[index].amount_sale;\r\n\t\t\tthis.id_stock = this.listOfitemInvoices[index].id_stock;\r\n\t\t\tthis.indexEdit = index\r\n\t\t},\r\n\t\tdeleteItemInvoice(index) {\r\n\t\t\tthis.listOfitemInvoices.splice(index, 1);\r\n\t\t\t// if the item deleted is what we re editing we reinitiate the form!\r\n\t\t\tif (this.indexEdit == index) {\r\n\t\t\t\tthis.title = ''\r\n\t\t\t\tthis.pu_sale = ''\r\n\t\t\t\tthis.amount_sale = ''\r\n\t\t\t\tthis.id_stock = ''\r\n\t\t\t\tthis.indexEdit = 'add'\r\n\t\t\t\tthis.pu_by = ''\r\n\t\t\t}\r\n\t\t},\r\n\t\tseek_amount_and_price_stock() {\r\n\t\t\tthis.stock_merchandises.forEach(element => {\r\n\t\t\t\tif (element.id_stock == this.id_stock) {\r\n\t\t\t\t\tthis.pu_by = element.pu_by\r\n\t\t\t\t\tthis.title = element.title\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tasync get_stock_merchandise() {\r\n\t\t\ttry {\r\n\t\t\t\tconst response = await axios.post('stock_merchandise/')\r\n\t\t\t\tthis.stock_merchandises = response.data\r\n\t\t\t} catch (e) {\r\n\t\t\t\talert(e)\r\n\t\t\t}\r\n\t\t},\r\n\t\ttryF() {\r\n\r\n\r\n\t\t},\r\n\r\n\t\tasync verifyAmount() {\r\n\t\t\tif (this.id_stock != '') {\r\n\t\t\t\tconst response = await axios.post('invoice/verifyAmount/' + this.id_stock)\r\n\t\t\t\tthis.amount_by = response.data\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync create_new_line_invoice_and_invoices() {\r\n\t\t\tif (this.client != '' && this.getNumberInvoices() > 0) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst form = new FormData()\r\n\t\t\t\t\tform.append('client', this.client)\r\n\t\t\t\t\tform.append('decrease', this.decrease)\r\n\t\t\t\t\tform.append('created_at', this.created_at + this.getCurrentTime())\r\n\t\t\t\t\tform.append('listOfitemInvoices', this.created_at + this.listOfitemInvoices)\r\n\t\t\t\t\tconst response = await axios.post('lineInvoice/create', form)\r\n\t\t\t\t\tthis.lastIdLine = response.data\r\n\t\t\t\t\tconsole.log(response.data)\r\n\t\t\t\t\t//i can now record each invoices\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\talert(e)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\talert(\"Veuiller d'abord compléter tous les champs requis pour une facture\")\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tasync trySendInvoice() {\r\n\t\t\t// const getFormData = object => Object.entries(object).reduce((fd, [key, val]) => { \r\n\t\t\t// \tif (Array.isArray(val)) {\r\n\t\t\t// \t\tval.forEach(v => fd.append(key, v))\r\n\t\t\t// \t} else {\r\n\t\t\t// \t\tfd.append(key, val)\r\n\t\t\t// \t}\r\n\t\t\t// \treturn fd\r\n\t\t\t// }, new FormData());\r\n\t\t\tconst formData = new FormData()\r\n\t\t\tformData.append(\"listOfitemInvoices\", JSON.stringify(this.listOfitemInvoices))\r\n\t\t\t// const response = await axios.post('invoice/create/', formData)\r\n\t\t\t// console.log(response.data)\r\n\t\t\taxios\r\n\t\t\t\t.post(\"invoice/create/\", formData, {\r\n\t\t\t\t\tonUploadProgress: (progressEvent) => console.log(progressEvent.loaded),\r\n\t\t\t\t\theaders: { \"Content-Type\": \"multipart/form-data\", },\r\n\t\t\t\t})\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t},\r\n\t\tasync async_create_each_invoice() {\r\n\t\t\tthis.listOfitemInvoices.forEach(element => {\r\n\t\t\t\t// const formData = new FormData()\r\n\t\t\t\t// formData.append(\"amount_sale\", element.amount_sale)\r\n\t\t\t\t// formData.append(\"id_stock\", element.id_stock)\r\n\t\t\t\t// formData.append(\"pu_sale\", element.pu_sale)\r\n\t\t\t\t// formData.append(\"id_line\", this.lastIdLine)\r\n\t\t\t\tthis.invoicesRequests.push(axios.post('invoice/create',\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t\"amount_sale\": element.amount_sale,\r\n\t\t\t\t\t\t\"id_stock\": element.id_stock,\r\n\t\t\t\t\t\t\"pu_sale\": element.pu_sale,\r\n\t\t\t\t\t\t\"id_line\": this.lastIdLine\r\n\t\t\t\t\t}\r\n\t\t\t\t).then(response => {\r\n\r\n\t\t\t\t}))\r\n\t\t\t});\r\n\r\n\t\t\tPromise.all(this.invoicesRequests).then(() => console.log('all recorded'))\r\n\r\n\t\t\t// await axios\r\n\t\t\t// \t.all([\r\n\t\t\t// \t\tthis.listOfitemInvoices.forEach(element => {\r\n\t\t\t// \t\t\tconst formData = new FormData()\r\n\t\t\t// \t\t\tformData.append(\"amount_sale\", element.amount_sale)\r\n\t\t\t// \t\t\tformData.append(\"id_stock\", element.id_stock)\r\n\t\t\t// \t\t\tformData.append(\"pu_sale\", element.pu_sale)\r\n\t\t\t// \t\t\tformData.append(\"id_line\", this.lastIdLine)\r\n\t\t\t// \t\t\taxios.post('invoice/create', formData)\r\n\t\t\t// \t\t})\r\n\t\t\t// \t])\r\n\t\t\t// \t.then(\r\n\t\t\t// \t\taxios.spread((...responses) => {\r\n\t\t\t// \t\t\tconsole.log(responses)\r\n\t\t\t// \t\t})\r\n\t\t\t// \t)\r\n\t\t\t// \t.catch(errors => {\r\n\t\t\t// \t\tconsole.error(errors)\r\n\t\t\t// \t});\r\n\t\t},\r\n\r\n\t\tgetCurrentTime() {\r\n\t\t\tconst dateObj = new Date();\r\n\t\t\tconst currentDate = \":\" + dateObj.getHours() + ':' + dateObj.getMinutes() + ':' + dateObj.getSeconds();\r\n\t\t\treturn currentDate\r\n\t\t},\r\n\t},\r\n\tcreated() {\r\n\t\tthis.get_stock_merchandise()\r\n\t}\r\n}\r\n</script>\r\n\r\n<style scoped>\r\nthead {\r\n\tborder: 2px solid rgb(220, 217, 217);\r\n\tborder-collapse: collapse;\r\n}\r\n\r\ntbody {\r\n\tborder-right: 1px solid rgb(221, 204, 204);\r\n\tborder-left: 1px solid rgb(220, 217, 217);\r\n\tborder-bottom: 2px solid rgb(220, 217, 217);\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}